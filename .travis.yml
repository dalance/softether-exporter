language: rust

os:
- linux
- osx

before_script:
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then rustup target add x86_64-unknown-linux-musl; fi
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then rustup target add x86_64-pc-windows-gnu; fi
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then sudo apt-get -qq update; fi
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then sudo apt-get -qq install gcc-mingw-w64-x86-64; fi

script:
- make test
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then make release_lnx; fi
- if [[ $TRAVIS_OS_NAME == "linux" ]]; then make release_win; fi
- if [[ $TRAVIS_OS_NAME == "osx"   ]]; then make release_osx; fi

deploy:
  provider: releases
  api_key:
    secure: OyUbHl4Z+oy+sLPRJJ4CHpNQX/ujeBap+LE9VL1ZGyQdPmvUN2ok2XMuZeXLK01GC+wgxnVuEO8O7+7RigKqPxlASyh7U0oTEIOIFDtEx6ZrYGdxrVgN83qzOOMZytDtz7ltDb1e2rdw0rg+ufOY3lWzSkCDA4LovAx9BgEVY//Xs8JHi8UIpxxLresBJGHqf6CnUtTrKNpzLtLDLla3D/3F2HdsYq9h22oF7RrQPziB/dQf5rO+gN6OvxP+tBrwnFXMvdYKrLJD/LcqbXmT1B+B+EzPOcewdtPO4AXSgtmwDQGXiCiaS5u52uhlrlrt0JAb/fX5iboMpKJ7i2oS3yXTj0gJm7PntyJnyCYyso8mVxcwNiE2Bs/A3AR4Cz5mJc7HlsL/6qECNFPbyx0bBMHa/NX65cj6D6+bswG3hfVMwmO1xV5URERUU1dXoh31X1CGGLZcFTi8fl7OJ6O8LJwwtDhC/GRY1QvODkuImaJDJX4Y3GBIyeAu0VCKiginomnYHzoU+iibkLaKzte6kZ8ONByg1dUl3iwKRZR3LZJ9KKrvKULpl5J3VHeQd+rPmcn+u0u37OCvw+u6zu3wisBNtjETvysFqw2v1fWiJ+aGEwGGmSraV+g1LZHWz417yXXLQfv4K8pGmHBvJ5GffF+G5WUY2ArN0GiAg6xcEk0=
  file: softether_exporter*.zip
  file_glob: true
  skip_cleanup: true
  on:
    repo: dalance/softether_exporter
    tags: true
